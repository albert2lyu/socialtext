* Fixture: SocialRest

This is a test of the WebHook system.

| *Comment*           | Create us a workspace, account and user       |
| standard-test-setup |                                               |
| st-admin            | give-accounts-admin --email %%email_address%% |

| *Comment* | Show that we have no hooks |
| st-clear-webhooks   | |
| GET | /data/webhooks | application/json |
| code-is | 200 |
| body-is | [] |

| *Comment* | Create a Signal hook |
| PUT_json | /data/webhooks | {"class":"signal","url":"http://www.postbin.org/1izgpp1"} |
| code-is | 201 |
| set-from-header | hook_uri | Location |
| GET | %%hook_uri%% |
| code-is | 200 |
| json-parse | |
| json-like | {"class":"signal","url":"http://www.postbin.org/1izgpp1"} |
| GET | /data/webhooks | application/json |
| code-is | 200 |
| json-parse | |
| json-like | [{"class":"signal","url":"http://www.postbin.org/1izgpp1"}] |

| *Comment*       | Trigger the Signal Hook |                                 |
| post-json       | /data/signals           | {"signal":"Hello %%username%%"} |
| code-is         | 201                     |                                 |
| st-process-jobs |                         |                                 |
| sleep | 2 |
| GET | http://www.postbin.org/1izgpp1 |
| code-is | 200 |
| body-like | Hello %%username%% |


| *Comment* | Delete a webhook |
| DELETE | %%hook_uri%% |
| code-is | 204 |
| GET | /data/webhooks | application/json |
| code-is | 200 |
| body-is | [] |



